<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Recorder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    audio {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>Audio Recorder</h2>
  <p>The iframe listens for recording commands from the parent page.</p>
  <audio id="audioPlayer" controls></audio>

  <script>
    let mediaRecorder;
    let recordedBlobs = [];
    let isRecording = false;

    // Function to start recording
    function startRecording() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('getUserMedia() is not supported by your browser.');
        return;
      }

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          recordedBlobs = [];
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = (event) => {
            if (event.data && event.data.size > 0) {
              recordedBlobs.push(event.data);
            }
          };

          mediaRecorder.start();
          isRecording = true;
          console.log('Recording started');
        })
        .catch(err => {
          console.error('Error accessing microphone:', err);
          alert('Error accessing your microphone. Please ensure your browser has permission.');
        });
    }

    // Function to stop recording
    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        console.log('Recording stopped');
      }
    }

    // Function to play the recorded audio
    function playRecording() {
      if (recordedBlobs.length > 0) {
        const superBuffer = new Blob(recordedBlobs, { type: 'audio/webm' });
        const audioURL = window.URL.createObjectURL(superBuffer);
        const audioPlayer = document.getElementById('audioPlayer');
        audioPlayer.src = audioURL;
        audioPlayer.style.display = 'block';
        console.log('Playing recorded audio');
      } else {
        alert('No audio recorded yet.');
      }
    }

    // Listen for messages from the parent (Wix site)
    window.addEventListener('message', (event) => {
      // Validate origin - replace with your Wix site's domain
      if (event.origin !== "https://your-wix-site-url.com") {
        console.error('Invalid origin:', event.origin);
        return;
      }

      // Act on the received message
      switch (event.data) {
        case 'startRecording':
          startRecording();
          break;
        case 'stopRecording':
          stopRecording();
          break;
        case 'playRecording':
          playRecording();
          break;
        default:
          console.error('Unknown message:', event.data);
      }
    }, false);
  </script>

</body>
</html>
